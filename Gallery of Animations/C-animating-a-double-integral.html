<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:640px;height:640px;display:inline-block;top:80px;position:absolute;"></div>
<span id='title' style="width:640px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" title="Previous value" onclick="mthlyONext(-1)" style="width:48px;left:452px;top:60px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyONext(1)" style="width:48px;left:503px;top:60px;position:absolute">Next</button>
<label for="mthlySldrO" style='top:60px;'>Method:</label>
<input type="range" id="mthlySldrO" min="1" max="6" value="1" style='left:176px;top:60px;' step="1"></input><span id="mthlySldrOvalue" style="left:397px;top:60px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlymNext(-1)" style="width:48px;left:452px;top:90px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlymNext(1)" style="width:48px;left:503px;top:90px;position:absolute">Next</button>
<label for="mthlySldrm" style='top:90px;'>X Subintervals:</label>
<input type="range" id="mthlySldrm" min="1" max="32" value="1" style='left:176px;top:90px;' step="1"></input><span id="mthlySldrmvalue" style="left:397px;top:90px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlynNext(-1)" style="width:48px;left:452px;top:120px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlynNext(1)" style="width:48px;left:503px;top:120px;position:absolute">Next</button>
<label for="mthlySldrn" style='top:120px;'>Y Subintervals:</label>
<input type="range" id="mthlySldrn" min="1" max="32" value="1" style='left:176px;top:120px;' step="1"></input><span id="mthlySldrnvalue" style="left:397px;top:120px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:150px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return "<font size=4>Double integral of f(x, y) = 16 - x<sup>2</sup> - 2y<sup>2</sup> over [0, 2] &times; [0, 2]</font>"; }
var x = [], t = [], X, Y, T, p;
function mthlyONext(d) {
  let x = O + d*mthlyOStep;
  if (x < mthlyOMin) {
    x = mthlyOMax;
  } else if (x > mthlyOMax) {
    x = mthlyOMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrO.value = x;
  document.getElementById("mthlySldrOvalue").innerHTML = x;
}
function mthlymNext(d) {
  let x = m + d*mthlymStep;
  if (x < mthlymMin) {
    x = mthlymMax;
  } else if (x > mthlymMax) {
    x = mthlymMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrm.value = x;
  document.getElementById("mthlySldrmvalue").innerHTML = x;
}
function mthlynNext(d) {
  let x = n + d*mthlynStep;
  if (x < mthlynMin) {
    x = mthlynMax;
  } else if (x > mthlynMax) {
    x = mthlynMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrn.value = x;
  document.getElementById("mthlySldrnvalue").innerHTML = x;
}

const mthlyLayout = {
  xaxis: { range: [0, 2.1]}, // plot with fixed axes
  yaxis: { range: [-0.05, 2.1], scaleanchor: 'x', scaleratio: 1 },
  showlegend: false
};

var mthlySldrO = document.getElementById('mthlySldrO');
var mthlySldrm = document.getElementById('mthlySldrm');
var mthlySldrn = document.getElementById('mthlySldrn');
mthlySldrO.value = 1;
var O = 1;
mthlySldrm.value = 8;
var m = 8;
mthlySldrn.value = 8;
var n = 8;
p = 1;
for (let i = 0; i <= p * (2.1 + 0) - 0; i += 0.0042) { x.push(i); }; t = x;

var mthlyTraces = [];
const mthlyxMin = 0, mthlyxMax = 2.1, mthlyxStep = 1;
const mthlyyMin = -0.05, mthlyyMax = 2.1;
const mthlytMin = 0, mthlytMax = 2.1, mthlytStep = 1;
const mthlyOMin = 1, mthlyOMax = 6, mthlyOStep = 1;
const mthlymMin = 1, mthlymMax = 32, mthlymStep = 1;
const mthlynMin = 1, mthlynMax = 32, mthlynStep = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  function f(x, y) { return 16 - x*x - 2*y*y; }
  let a = 0, b = 2, c = 0, d = 2;

  let rule = (O == 1)? 'Mid' : ((O == 2)? 'Left down end' : ((O == 3)? 'Right up end' : ((O == 4)? 'Left up end' : ((O == 5)? 'Right down end' : 'Random '))));
  function plotgrids(hx, hy) {
    let x = a, y = c;
    for (i = 0; i <= m; i++) {
      mthlyTraces.push({ x: [x, x], y: [c, d], mode: 'lines', line: { color: 'green', width: 1  } });
      x += hx;
    }
    for (i = 0; i <= n; i++) {
      mthlyTraces.push({ x: [a, b], y: [y, y], mode: 'lines', line: { color: 'green', width: 1  } });
      y += hy;
    }
  }
  function sum() {
    let hx = (b - a) / m, hy = (d - c) / n;
    let randq = false;
    plotgrids(hx, hy);
    var x, ystart, s = 0;
    if (O == 1) {
      x = a + hx / 2; ystart = c + hy / 2; rule = 'Mid';
    } else if (O == 2) {
      x = a; ystart = c; rule = 'Left down end';
    } else if (O == 3) {
      x = a; ystart = c + hy; rule = 'Left up end';
    } else if (O == 4) {
      x = a + hx; ystart = c; rule = 'Right down end';
    } else if (O == 5) {
      x = a + hx; ystart = c + hy; rule = 'Right up end';
    } else {
      randq = true; rule = 'Random ';
    }

    if (randq) {
      x = a;
      for (i = 0; i < m; i++) {
        y = c;
        for (j = 0; j < n; j++ ) {
          let X = x + hx * Math.random(), Y = y + hy * Math.random();
          mthlyTraces.push({ x: [X], y: [Y], mode: 'markers', marker: { color: 'red', size: 6  } });
          s += f(X, Y);
          y += hy;
        }
        x += hx;
      }
    } else {
      for (i = 1; i <= m; i++) {
        let y = ystart;
        for (j = 1; j <= n; j++) {
          mthlyTraces.push({ x: [x], y: [y], mode: 'markers', marker: { color: 'red', size: 6  } });
          s += f(x, y);
          y += hy;
        }
        x += hx;
      }
    }

    // plot enough extra objects outside the graph so that no old traces will stay - ugly, but works!
    x = mthlyxMax + 1;
    for (i = 0; i < mthlymMax; i++) {
      y = mthlyyMax + 1
      for (j = 0; j < mthlynMax; j++) {
        mthlyTraces.push({ x: [x], y: [y], mode: 'markers'});
        y += hy;
      }
      x += hx;
    }
    return s * hx * hy;
  }

  function displaytext() { const s = sum(); return rule + 'point method: V = ' + s + ' (Exact value: 48)'; }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: x, y: x.map(x => mthlyyMax + 5), mode: 'lines', line: { simplify: false }, fill: 'none' });
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999, 99999999, 99999999];

function mthlyAnimatePlot() {
  O = Number(mthlySldrO.value);
  m = Number(mthlySldrm.value);
  n = Number(mthlySldrn.value);
  // has any controls changed?
  mthlyNewCs = [O, m, n];
  var unchangedq = true;
  for (let i = 0; i < 3; i++) {
    if (Math.abs(mthlyOldCs[i] - mthlyNewCs[i]) > 0.00001) {
      unchangedq = false; break;
    }
  }
  if (unchangedq) { return; }
  mthlyOldCs = [O, m, n]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrOvalue").innerHTML = mthlySldrO.value;
mthlySldrO.addEventListener("input", function() { document.getElementById("mthlySldrOvalue").innerHTML = mthlySldrO.value; });
document.getElementById("mthlySldrmvalue").innerHTML = mthlySldrm.value;
mthlySldrm.addEventListener("input", function() { document.getElementById("mthlySldrmvalue").innerHTML = mthlySldrm.value; });
document.getElementById("mthlySldrnvalue").innerHTML = mthlySldrn.value;
mthlySldrn.addEventListener("input", function() { document.getElementById("mthlySldrnvalue").innerHTML = mthlySldrn.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
