<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<input type='text' id='title' style="width:640px;left:0px;text-align:center;border:none;"></input>
<div id="mathlyDiv" style="width:640px;height:640px;display:inline-block;top:50px;position:absolute;"></div>
<!-- controls -->
<label for="mthlySldr1" style='top:60px;'>Iterations:</label>
<input type="range" id="mthlySldr1" min="1" max="56" value="1" style='left:144px;top:60px;' step="1"></input><span id="mthlySldr1value" style="left:365px;top:60px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:90px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
var x = [];
var t = [];
var X, Y, T, p;

const mthlyLayout = {
  'xaxis': { 'range': [-3.1, 2.1]}, // plot with fixed axes
  'yaxis': { 'range': [-22, 8] },
  'showlegend': false
};

var title = document.getElementById('title');
title.value = 'Midpoint method for x^3 - 2*x + 2 = 0 starting on [-3, 2]';
var mthlySldr1 = document.getElementById('mthlySldr1');
mthlySldr1.value = 1;
var I = 1;
p = 1;
for (let i = -3.1; i <= p * (2.1 + 3.1) - 3.1; i += 0.0104) { t.push(i); }

var mthlyTraces = [];
const mthlyxMin = -3.1, mthlyxMax = 2.1, mthlyyMin = -22, mthlyyMax = 8;
const mthlytMin = -3.1, mthlytMax = 2.1;
const mthlyIMin = 1, mthlyIMax = 56;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  let a = -3, b = 2;
  let A = a, B = b;
  function f(x)   { return x**3 - 2*x + 2; }
  let fa = f(a), fb = f(b);
  var ab = [], midpts = [];
  ab.push([a, b]);
  for (let i = 1; i <= 56; i += 1) {
    let midpt = (a + b) / 2, fmidpt = f(midpt);
    if (fa * fmidpt > 0) {
      a = midpt; fa = fmidpt;
    } else {
      b = midpt; fb = fmidpt;
    }
    midpts.push(midpt);
    ab.push([a, b]);
  }
  a = A; b = B;

  function displaytext() { return '[' + ab[I-1][0] + ', ' + ab[I-1][1] + '], midpoint = ' + midpts[I-1]; }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ 'x': t.map(t => t), 'y': t.map(t => f(ab[I-1][0]) + (f(ab[I-1][1]) - f(ab[I-1][0])) / (ab[I-1][1] - ab[I-1][0]) * (t - ab[I-1][0])), 'mode': 'lines', 'line': { 'simplify': false } });
  if (true) {
    const t = [];
    for (let i = -3.1; i <= 2.1; i += 0.0104) { t.push(i); }
    mthlyTraces.push({ 'x': t.map(t => t), 'y': t.map(t => t**3 - 2*t + 2), 'mode': 'lines', 'line': { 'simplify': false, 'color': 'orange', 'width': 3  } });
  }
  mthlyTraces.push({ 'x': [ab[I-1][0], ab[I-1][0]], 'y': [f(ab[I-1][0]), 0], 'mode': 'lines', 'line': { 'color': 'grey', 'width': 1  } });
  mthlyTraces.push({ 'x': [ab[I-1][0]], 'y': [0], 'mode': 'markers', 'marker': { 'color': 'green', 'size': 8.000000  } });
  mthlyTraces.push({ 'x': [midpts[I-1], midpts[I-1]], 'y': [f(midpts[I-1]), 0], 'mode': 'lines', 'line': { 'color': 'grey', 'width': 1  } });
  mthlyTraces.push({ 'x': [ab[I-1][1], ab[I-1][1]], 'y': [f(ab[I-1][1]), 0], 'mode': 'lines', 'line': { 'color': 'grey', 'width': 1  } });
  mthlyTraces.push({ 'x': [ab[I-1][1]], 'y': [0], 'mode': 'markers', 'marker': { 'color': 'blue', 'size': 8.000000  } });
  mthlyTraces.push({ 'x': [midpts[I-1]], 'y': [0], 'mode': 'markers', 'marker': { 'color': 'red', 'size': 8.000000  } });
  mthlyTraces.push({ 'x': [ab[I-1][0]], 'y': [1], 'text': 'a', 'mode': 'text', 'type': 'scatter', 'textposition': 'bottom', 'name': '', 'textfont': { 'color': 'black', 'size': 12.000000  } });
  mthlyTraces.push({ 'x': [ab[I-1][1]], 'y': [-0.5], 'text': 'b', 'mode': 'text', 'type': 'scatter', 'textposition': 'bottom', 'name': '', 'textfont': { 'color': 'black', 'size': 12.000000  } });
  mthlyTraces.push({ 'x': [midpts[I-1]], 'y': [-0.5], 'text': 'midpoint', 'mode': 'text', 'type': 'scatter', 'textposition': 'bottom', 'name': '', 'textfont': { 'color': 'black', 'size': 12.000000  } });
  document.getElementById("displaytext").innerHTML = displaytext();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyOldCs = [99999999];
var mthlyNewCs = [];
function mthlyAnimatePlot() {
  I = Number(mthlySldr1.value);
  // has any controls changed?
  mthlyNewCs = [I];
  if (Math.abs(mthlyOldCs[0] - mthlyNewCs[0]) < 0.00001) { return; }
  mthlyOldCs = [I]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    'data': mthlyTraces,
    'traces': mthlyTraces.keys() // update all traces
  }, {
    'transition': { 'duration': 0 },
    'frame': { 'duration': 0 }
  });
}

document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value;
mthlySldr1.addEventListener("input", function() { document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value; mthlyAnimatePlot() });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
