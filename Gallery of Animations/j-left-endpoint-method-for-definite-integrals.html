<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<input type='text' id='title' style="width:540px;left:0px;text-align:center;border:none;"></input>
<div id="mathlyDiv" style="width:540px;height:540px;display:inline-block;top:50px;position:absolute;"></div>
<!-- controls -->
<label for="mthlySldr1" style='top:60px;'>N:</label>
<input type="range" id="mthlySldr1" min="1" max="20" value="1" style='top:60px;' step="1"></input><span id="mthlySldr1value" style="left:290px;top:60px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:90px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
var x = [];
var t = [];
var X, Y, T, p;

const mthlyLayout = {
  'xaxis': { 'range': [-0.1, 1.1], 'showgrid': false}, // plot with fixed axes
  'yaxis': { 'range': [-0.1, 1.12], 'showgrid': false, 'scaleanchor': 'x', 'scaleratio': 1 },
  'showlegend': false
};

var title = document.getElementById('title');
title.value = 'Left-Endpoint Method';
var mthlySldr1 = document.getElementById('mthlySldr1');
mthlySldr1.value = 20;
var N = 20;
p = 1;
for (let i = -0.1; i <= p * (1.1 + 0.1) - 0.1; i += 0.0024) { x.push(i); }

var mthlyTraces = [];
function mthlyUpdateTraces() {
  mthlyTraces = []; // or .length = 0;

  // vvvvv user's javascript vvvvv
  function f(x) { return 1 - x*x; }
  const a = 0, b = 1;
  const h = (b - a) / N;
  function plotboxes() {
    var x1 = a, f1 = f(a);
    for (let i = 0; i < N; i++) {
      const x2 = x1 + h, f2 = f(x2); // mthlyTraces, a javascript "global" variables
      mthlyTraces.push({'x': [x1, x1], 'y': [0, f1], 'mode': 'lines', 'line': { 'color': 'grey', 'width': 1 } });
      mthlyTraces.push({'x': [x1, x2], 'y': [f1, f1], 'mode': 'lines', 'line': { 'color': 'grey', 'width': 1 } }); // left-endpoint
      mthlyTraces.push({'x': [x2, x2], 'y': [f1, 0], 'mode': 'lines', 'line': { 'color': 'grey', 'width': 1 } });
      x1 = x2; f1 = f2;
    }
  }
  function sum() {
    plotboxes();
    var s = 0;
    for (let i = 0; i < N; i++) { s += f(a + i*h); }
    return s * h;
  }
  function displaytext() { return 'Approximation: ' + sum(); }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ 'x': x, 'y': x.map(x => 1 - x**2), 'mode': 'lines', 'line': { 'simplify': false } });

  document.getElementById("displaytext").innerHTML = displaytext();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyOldCs = [99999999];
var mthlyNewCs = [];
function mthlyAnimatePlot() {
  N = Number(mthlySldr1.value);
  // has any controls changed?
  mthlyNewCs = [N];
  if (Math.abs(mthlyOldCs[0] - mthlyNewCs[0]) < 0.00001) { return; }
  mthlyOldCs = [N]; // update values of controls

  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    'data': mthlyTraces,
    'traces': mthlyTraces.keys() // update all traces
  }, {
    'transition': { 'duration': 0 },
    'frame': { 'duration': 0 }
  });
}

document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value;
mthlySldr1.addEventListener("input", function() { document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value; mthlyAnimatePlot() });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
