<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:800px;height:600px;display:inline-block;top:50px;position:absolute;"></div>
<span id='title' style="width:800px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" onclick="mthlyPlay()" style="left:377px;top:60px;position:absolute">Play</button> <button type="button" onclick="mthlyStop()" style="left:428px;top:60px;position:absolute">Stop</button>
<label for="mthlySldr1" style='top:60px;'>Play:</label>
<input type="range" id="mthlySldr1" min="0" max="1" value="0" style='left:96px;top:60px;' step="0.01"></input><span id="mthlySldr1value" style="left:317px;top:60px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:90px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext()  { return ""; }   // to be overwritten
function displaytitle() { return "<h3><em>y = x<sup>2</sup></em></h3>"; } //
var x = [];
var t = [];
var X, Y, T, p;
var mthlyAutoPlayq = true;
function mthlyPlay() { mthlyAutoPlayq = true; }
function mthlyStop() { mthlyAutoPlayq = false; }
var mthlySldr1step = 0.01;

const mthlyLayout = {
  'xaxis': { 'range': [-5, 5]}, // plot with fixed axes
  'yaxis': { 'range': [-5, 5], 'scaleanchor': 'x', 'scaleratio': 1 },
  'showlegend': false
};

var mthlySldr1 = document.getElementById('mthlySldr1');
mthlySldr1.value = 0.43;
var p = 0.43;
for (let i = -5; i <= p * (5 + 5) - 5; i += 0.02) { t.push(i); }
let mthlyTmp = t[t.length - 1];
if (true) { const t = mthlyTmp; X = t; Y = t*t; T = mthlyTmp; }

var mthlyTraces = [];
const mthlyxMin = -5, mthlyxMax = 5, mthlyyMin = -5, mthlyyMax = 5;
const mthlytMin = -5, mthlytMax = 5;
const mthlypMin = 0, mthlypMax = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  function f(x) { return x*x; }  // f(x) = x^2
  function fp(x) { return 2*x; } // f'(x) = 2x
  function fpp(x) { return 2; }  // f''(x) = 2
  function m(x) { return Math.sqrt(1 + fp(x)**2); }
  function mp(x) { return 4*x / Math.sqrt(1 + 4*x*x); } // setup: m'(x) = 4x / sqrt(1 + 4x^2)
  function k(x) { const z = 1 + fp(x)**2; return Math.abs(fpp(x)) / (z * Math.sqrt(z)); }
  function q(x) { return fpp(x)*m(x) - fp(x) * mp(x); }  // do NOT use p which is reserved for 'play'
  const cx = X - mp(X) / (k(X) * Math.sqrt(mp(X)**2 + q(X)**2));   // (cx, cy), center of osculation circle at (X, Y)
  const cy = f(X) + q(X) / (k(X) * Math.sqrt(mp(X)**2 + q(X)**2));
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ 'x': t.map(t => t), 'y': t.map(t => t*t), 'mode': 'lines', 'line': { 'simplify': false } });
  if (true) {
    const t = [];
    for (let i = -6.2831853071796; i <= 6.2831853071796; i += 0.025132741228718) { t.push(i); }
    mthlyTraces.push({ 'x': t.map(t => t), 'y': t.map(t => t*t), 'mode': 'lines', 'line': { 'simplify': false, 'color': 'blue', 'width': 3  } });
  }
  if (true) {
    const t = [];
    for (let i = 0; i <= 6.2831853071796; i += 0.012566370614359) { t.push(i); }
    mthlyTraces.push({ 'x': t.map(t => cx + Math.cos(t) / k(X)), 'y': t.map(t => cy + Math.sin(t) / k(X)), 'mode': 'lines', 'line': { 'simplify': false, 'color': 'orange', 'width': 3  } });
  }
  mthlyTraces.push({ 'x': [X], 'y': [Y], 'mode': 'markers', 'marker': { 'color': 'red', 'size': 10.000000  } });
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyOldCs = [99999999];
var mthlyNewCs = [];
function mthlyAnimatePlot() {
  if (mthlyAutoPlayq) {
    let x = String(Number(mthlySldr1.value) + mthlySldr1step);
    mthlySldr1.value = String(x);
    if (x > 1) { mthlySldr1.value = '0'; }
    document.getElementById("mthlySldr1value").innerHTML = '' + Math.round(mthlySldr1.value*100) + '%'
  }
  p = Number(mthlySldr1.value);
  t = []; for (let i = -5; i <= p * (5 + 5) - 5; i += 0.02) { t.push(i); };
  T = t[t.length - 1];
  if (true) { const t = T; X = t; Y = t*t; };
  // has any controls changed?
  mthlyNewCs = [p];
  if (Math.abs(mthlyOldCs[0] - mthlyNewCs[0]) < 0.00001) { return; }
  mthlyOldCs = [p]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    'data': mthlyTraces,
    'traces': mthlyTraces.keys() // update all traces
  }, {
    'transition': { 'duration': 0 },
    'frame': { 'duration': 0 }
  });
}

document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value;
mthlySldr1.addEventListener("input", function() { document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value; mthlyAutoPlayq = false; mthlyAnimatePlot() });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
