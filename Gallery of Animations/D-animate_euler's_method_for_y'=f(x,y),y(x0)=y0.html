<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:500px;height:500px;display:inline-block;top:50px;position:absolute;"></div>
<span id='title' style="width:500px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" title="Previous value" onclick="mthlyINext(-1)" style="width:48px;left:436px;top:60px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyINext(1)" style="width:48px;left:487px;top:60px;position:absolute">Next</button>
<label for="mthlySldrI" style='top:60px;'>Iterations:</label>
<input type="range" id="mthlySldrI" min="1" max="50" value="1" style='left:160px;top:60px;' step="1"></input><span id="mthlySldrIvalue" style="left:381px;top:60px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlynNext(-1)" style="width:48px;left:436px;top:90px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlynNext(1)" style="width:48px;left:487px;top:90px;position:absolute">Next</button>
<label for="mthlySldrn" style='top:90px;'>Subintervals:</label>
<input type="range" id="mthlySldrn" min="1" max="50" value="1" style='left:160px;top:90px;' step="1"></input><span id="mthlySldrnvalue" style="left:381px;top:90px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:120px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return ""; }
var x = [], t = [], X, Y, T, p;
function mthlyINext(x) {
  x = I + x*mthlyIStep;
  if (x < mthlyIMin) {
    x = mthlyIMax;
  } else if (x > mthlyIMax) {
    x = mthlyIMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrI.value = x;
  document.getElementById("mthlySldrIvalue").innerHTML = x;
}
function mthlynNext(x) {
  x = n + x*mthlynStep;
  if (x < mthlynMin) {
    x = mthlynMax;
  } else if (x > mthlynMax) {
    x = mthlynMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrn.value = x;
  document.getElementById("mthlySldrnvalue").innerHTML = x;
}

const mthlyLayout = {
  xaxis: { range: [0, 5]}, // plot with fixed axes
  yaxis: { range: [0, 10], scaleanchor: 'x', scaleratio: 1 },
  showlegend: false
};

var mthlySldrI = document.getElementById('mthlySldrI');
var mthlySldrn = document.getElementById('mthlySldrn');
mthlySldrI.value = 15;
var I = 15;
mthlySldrn.value = 17;
var n = 17;
p = 1;
for (let i = 0; i <= p * (5 + 0) - 0; i += 0.01) { x.push(i); }; t = x;

var mthlyTraces = [];
const mthlyxMin = 0, mthlyxMax = 5, mthlyxStep = 1;
const mthlyyMin = 0, mthlyyMax = 10;
const mthlytMin = 0, mthlytMax = 5, mthlytStep = 1;
const mthlyIMin = 1, mthlyIMax = 50, mthlyIStep = 1;
const mthlynMin = 1, mthlynMax = 50, mthlynStep = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  function f(x, y) { return 1/15*Math.exp(x); }
  const a = 0.000000, b = 5.000000;
  var h;
  function plotsolu() {
    var xs = [0.000000], ys = [1.000000];
    h = (b - a) / n;
    let style = {'color': 'red', 'width': 1}
    var xi = xs[0], yi = ys[0];
    for (let i = 1; i < Math.min(I, n); i++) {
      yi = yi + f(xi, yi)*h; ys.push(yi);
      xi = xi + h; xs.push(xi);
      mthlyTraces.push({x: [xs[i-1], xs[i] ], y: [ys[i-1], ys[i] ], mode: 'lines+markers', line: style});
    }

    // plot enough extra objects outside the graph so that no old traces will stay - ugly, but works!
    for (let i = 1; i <= mthlyIMax; i ++) {
      mthlyTraces.push({x: [mthlyxMax + 10], y: [mthlyyMax + 10], mode: 'markers'})
    }
  }

  function displaytext() { plotsolu(); return 'Increment in <i>x</i>: ' + h; };
  function displaytitle() { return "<h3>Animating Euler's method for <i>y' = 1/15 e<sup>x</sup>, y(0) = 1</i></h3>"};
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: x, y: x.map(x => 1/15*Math.exp(x) + 14/15), mode: 'lines', line: { simplify: false, color: 'green', width: 2 }, fill: 'none' });
  mthlyTraces.push({ x: [0], y: [1], mode: 'markers', marker: { color: 'red', size: 8.000000  } });
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999, 99999999];

function mthlyAnimatePlot() {
  I = Number(mthlySldrI.value);
  n = Number(mthlySldrn.value);
  // has any controls changed?
  mthlyNewCs = [I, n];
  var unchangedq = true;
  for (let i = 0; i < 2; i++) {
    if (Math.abs(mthlyOldCs[i] - mthlyNewCs[i]) > 0.00001) {
      unchangedq = false; break;
    }
  }
  if (unchangedq) { return; }
  mthlyOldCs = [I, n]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value;
mthlySldrI.addEventListener("input", function() { document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value; });
document.getElementById("mthlySldrnvalue").innerHTML = mthlySldrn.value;
mthlySldrn.addEventListener("input", function() { document.getElementById("mthlySldrnvalue").innerHTML = mthlySldrn.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
