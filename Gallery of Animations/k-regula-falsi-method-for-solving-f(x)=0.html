<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:640px;height:640px;display:inline-block;top:80px;position:absolute;"></div>
<span id='title' style="width:640px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" title="Previous value" onclick="mthlymNext(-1)" style="width:48px;left:452px;top:60px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlymNext(1)" style="width:48px;left:503px;top:60px;position:absolute">Next</button>
<label for="mthlySldrm" style='top:60px;'>Method:</label>
<input type="range" id="mthlySldrm" min="1" max="2" value="1" style='left:176px;top:60px;' step="1"></input><span id="mthlySldrmvalue" style="left:397px;top:60px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlyrNext(-1)" style="width:48px;left:452px;top:90px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyrNext(1)" style="width:48px;left:503px;top:90px;position:absolute">Next</button>
<label for="mthlySldrr" style='top:90px;'>Reset count to:</label>
<input type="range" id="mthlySldrr" min="0" max="2" value="0" style='left:176px;top:90px;' step="1"></input><span id="mthlySldrrvalue" style="left:397px;top:90px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlyINext(-1)" style="width:48px;left:452px;top:120px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyINext(1)" style="width:48px;left:503px;top:120px;position:absolute">Next</button>
<label for="mthlySldrI" style='top:120px;'>Iterations:</label>
<input type="range" id="mthlySldrI" min="1" max="67" value="1" style='left:176px;top:120px;' step="1"></input><span id="mthlySldrIvalue" style="left:397px;top:120px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:150px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return "<h3>Regula falsi method for x<sup>3</sup> - 2x + 2 = 0 starting on [-3, 2]</h3>"; }
var x = [], t = [], X, Y, T, p;
function mthlymNext(d) {
  let x = m + d*mthlymStep;
  if (x < mthlymMin) {
    x = mthlymMax;
  } else if (x > mthlymMax) {
    x = mthlymMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrm.value = x;
  document.getElementById("mthlySldrmvalue").innerHTML = x;
}
function mthlyrNext(d) {
  let x = r + d*mthlyrStep;
  if (x < mthlyrMin) {
    x = mthlyrMax;
  } else if (x > mthlyrMax) {
    x = mthlyrMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrr.value = x;
  document.getElementById("mthlySldrrvalue").innerHTML = x;
}
function mthlyINext(d) {
  let x = I + d*mthlyIStep;
  if (x < mthlyIMin) {
    x = mthlyIMax;
  } else if (x > mthlyIMax) {
    x = mthlyIMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrI.value = x;
  document.getElementById("mthlySldrIvalue").innerHTML = x;
}

const mthlyLayout = {
  xaxis: { range: [-3.1, 2.1]}, // plot with fixed axes
  yaxis: { range: [-22, 8] },
  showlegend: false
};

var mthlySldrm = document.getElementById('mthlySldrm');
var mthlySldrr = document.getElementById('mthlySldrr');
var mthlySldrI = document.getElementById('mthlySldrI');
mthlySldrm.value = 1;
var m = 1;
mthlySldrr.value = 0;
var r = 0;
mthlySldrI.value = 1;
var I = 1;
p = 1;
for (let i = -3.1; i <= p * (2.1 + 3.1) - 3.1; i += 0.0104) { t.push(i); }

var mthlyTraces = [];
const mthlyxMin = -3.1, mthlyxMax = 2.1, mthlyxStep = 1;
const mthlyyMin = -22, mthlyyMax = 8;
const mthlytMin = -3.1, mthlytMax = 2.1, mthlytStep = 1;
const mthlymMin = 1, mthlymMax = 2, mthlymStep = 1;
const mthlyrMin = 0, mthlyrMax = 2, mthlyrStep = 1;
const mthlyIMin = 1, mthlyIMax = 67, mthlyIStep = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  let a = -3, b = 2;
  let A = a, B = b;
  function f(x) { return x**3 - 2*x + 2; }
  let fa = f(a), fb = f(b);
  var ab = [], midpts = [];
  var fas = [fa], fbs = [fb];
  var counta = 0, countb = 0;
  ab.push([a, b]);
  for (let i = 1; i <= 67; i += 1) {
    let midpt = a - (b - a)/(fb - fa) * fa, fmidpt = f(midpt);
    if (fa * fmidpt > 0) {
      a = midpt; fa = fmidpt;
      if (m == 2) {
        counta = counta + 1; countb = 0;
        if (counta == 3) { fb = fb/2; counta = r; } // reset counta to r (0/1/2)
      }
    } else {
      b = midpt; fb = fmidpt;
      if (m == 2) {
        counta = 0; countb = countb + 1;
        if (countb == 3) { fa = fa/2; countb = r; } // reset countb to r (0/1/2)
      }
    }
    midpts.push(midpt);
    ab.push([a, b]);
    fas.push(fa); fbs.push(fb);
  }
  a = A; b = B;

  function displaytext() { return ((m == 1)? 'Original ' : 'Modified') +' method: [' + ab[I-1][0] + ', ' + ab[I-1][1] + '], x-intercept = ' + midpts[I-1]; }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: t.map(t => t), y: t.map(t => f(ab[I-1][0]) + (f(ab[I-1][1]) - f(ab[I-1][0])) / (ab[I-1][1] - ab[I-1][0]) * (t - ab[I-1][0])), mode: 'lines', line: { simplify: false }, fill: 'none' });
  mthlyTraces.push({ x: [ab[I-1][0], ab[I-1][1]], y: [fas[I-1], fbs[I-1]], mode: 'lines', line: { color: 'grey', width: 1  } });
  if (true) {
    const t = [];
    for (let i = -3.1; i <= 2.1; i += 0.0104) { t.push(i); }
    mthlyTraces.push({ x: t.map(t => t), y: t.map(t => t**3 - 2*t + 2), mode: 'lines', line: { simplify: false, color: 'orange', width: 3  }, fill: 'none' });
  }
  mthlyTraces.push({ x: [ab[I-1][0], ab[I-1][0]], y: [f(ab[I-1][0]), 0], mode: 'lines', line: { color: 'grey', width: 1  } });
  mthlyTraces.push({ x: [ab[I-1][0]], y: [0], mode: 'markers', marker: { color: 'green', size: 8.000000  } });
  mthlyTraces.push({ x: [ab[I-1][0]], y: [fas[I-1]], mode: 'markers', marker: { color: 'green', size: 12.000000 , 'symbol': 'circle-open' } });
  mthlyTraces.push({ x: [ab[I-1][1], ab[I-1][1]], y: [f(ab[I-1][1]), 0], mode: 'lines', line: { color: 'grey', width: 1  } });
  mthlyTraces.push({ x: [ab[I-1][1]], y: [0], mode: 'markers', marker: { color: 'blue', size: 8.000000  } });
  mthlyTraces.push({ x: [ab[I-1][1]], y: [fbs[I-1]], mode: 'markers', marker: { color: 'blue', size: 12.000000 , 'symbol': 'circle-open' } });
  mthlyTraces.push({ x: [midpts[I-1]], y: [0], mode: 'markers', marker: { color: 'red', size: 8.000000  } });
  mthlyTraces.push({ x: [ab[I-1][0]], y: [1], text: 'a', mode: 'text', type: 'scatter', textposition: 'bottom center', name: '', textfont: { color: 'black', size: 12.000000  } });
  mthlyTraces.push({ x: [ab[I-1][1]], y: [-0.5], text: 'b', mode: 'text', type: 'scatter', textposition: 'bottom center', name: '', textfont: { color: 'black', size: 12.000000  } });
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999, 99999999, 99999999];

function mthlyAnimatePlot() {
  m = Number(mthlySldrm.value);
  r = Number(mthlySldrr.value);
  I = Number(mthlySldrI.value);
  // has any controls changed?
  mthlyNewCs = [m, r, I];
  var unchangedq = true;
  for (let i = 0; i < 3; i++) {
    if (Math.abs(mthlyOldCs[i] - mthlyNewCs[i]) > 0.00001) {
      unchangedq = false; break;
    }
  }
  if (unchangedq) { return; }
  mthlyOldCs = [m, r, I]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrmvalue").innerHTML = mthlySldrm.value;
mthlySldrm.addEventListener("input", function() { document.getElementById("mthlySldrmvalue").innerHTML = mthlySldrm.value; });
document.getElementById("mthlySldrrvalue").innerHTML = mthlySldrr.value;
mthlySldrr.addEventListener("input", function() { document.getElementById("mthlySldrrvalue").innerHTML = mthlySldrr.value; });
document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value;
mthlySldrI.addEventListener("input", function() { document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
