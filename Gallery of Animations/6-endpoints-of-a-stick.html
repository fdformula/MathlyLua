<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<input type='text' id='title' style="width:640px;left:0px;text-align:center;border:none;"></input>
<div id="mathlyDiv" style="width:640px;height:480px;display:inline-block;top:110px;position:absolute;"></div>
<!-- controls -->
<button type="button" onclick="mthlyPlay()" style="left:345px;top:60px;position:absolute">Play</button> <button type="button" onclick="mthlyStop()" style="left:395px;top:60px;position:absolute">Stop</button>
<label for="mthlySldr1" style='top:60px;'>p:</label>
<input type="range" id="mthlySldr1" min="0" max="1" value="0" style='top:60px;' step="0.01"></input><span id="mthlySldr1value" style="left:290px;top:60px;position:absolute">&nbsp;</span>
<label for="mthlySldr2" style='top:90px;'>R:</label>
<input type="range" id="mthlySldr2" min="0.1" max="5" value="0.1" style='top:90px;' step="0.1"></input><span id="mthlySldr2value" style="left:290px;top:90px;position:absolute">&nbsp;</span>
<label for="mthlySldr3" style='top:120px;'>b:</label>
<input type="range" id="mthlySldr3" min="0.1" max="5" value="0.1" style='top:120px;' step="0.1"></input><span id="mthlySldr3value" style="left:290px;top:120px;position:absolute">&nbsp;</span>
<label for="mthlySldr4" style='top:150px;'>L:</label>
<input type="range" id="mthlySldr4" min="0.1" max="5" value="0.1" style='top:150px;' step="0.1"></input><span id="mthlySldr4value" style="left:290px;top:150px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:180px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
var x = [];
var t = [];
var X, Y, T, p;
var mthlyAutoPlayq = true;
function mthlyPlay() { mthlyAutoPlayq = true; }
function mthlyStop() { mthlyAutoPlayq = false; }
var mthlySldr1step = 0.01;

const mthlyLayout = {
  'xaxis': { 'range': [-3, 5], 'showgrid': false, 'zeroline': false, 'showticklabels': false}, // plot with fixed axes
  'yaxis': { 'range': [-5, 5], 'showgrid': false, 'zeroline': false, 'showticklabels': false, 'scaleanchor': 'x', 'scaleratio': 1 },
  'showlegend': false
};

var title = document.getElementById('title');
title.value = '';
var mthlySldr1 = document.getElementById('mthlySldr1');
var mthlySldr2 = document.getElementById('mthlySldr2');
var mthlySldr3 = document.getElementById('mthlySldr3');
var mthlySldr4 = document.getElementById('mthlySldr4');
mthlySldr1.value = 0;
var p = 0;
mthlySldr2.value = 2;
var R = 2;
mthlySldr3.value = 2.7;
var b = 2.7;
mthlySldr4.value = 5;
var L = 5;
for (let i = 0; i <= p * (6.2831853071796 + 0) - 0; i += 0.012566370614359) { t.push(i); }
let mthlyTmp = t[t.length - 1];
if (true) { const t = mthlyTmp; X = R * Math.cos(t) + 0*b + 0*L; Y = R * Math.sin(t); T = mthlyTmp; }

var mthlyTraces = [];
function mthlyUpdateTraces() {
  mthlyTraces = []; // or .length = 0;

  // vvvvv user's javascript vvvvv
  // The line passes thru (b,0) and (X,Y) is y = (Y/(X-b))(x-b). So, x = b + ((X-b)/Y)y. Solve
  // (x-X)^2 + (y-Y)^2 = L^2 for y and then obtain x.
  var Xb = X - b;
  var z = Xb / Y;
  var xx, yy = Y + Xb*z;
  var s = Math.sqrt(L*L - b*b - (Xb - b)*X + 2*Y*Xb*z + (L*L - Y*Y)*z*z);
  if (Y > 0) {
    yy = yy - s;
  } else {
    yy = yy + s;
  }
  yy = yy / (1 + z*z);
  xx = b + z * yy;
  // function displaytext() { return 'Hello! L = ' + L; }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ 'x': t.map(t => R * Math.cos(t) + 0*b + 0*L), 'y': t.map(t => R * Math.sin(t)), 'mode': 'lines', 'line': { 'simplify': false } });

  if (true) {
    const t = [];
    for (let i = 0; i <= 6.2831853071796; i += 0.012566370614359) { t.push(i); }
    mthlyTraces.push({ 'x': t.map(t => R * Math.cos(t) + 0*b + 0*L), 'y': t.map(t => R * Math.sin(t)), 'mode': 'lines', 'line': { 'simplify': false, 'color': 'blue', 'width': 3  } });
  }
  if (true) {
    const t = [];
    for (let i = 0; i <= 6.2831853071796; i += 0.012566370614359) { t.push(i); }
    mthlyTraces.push({ 'x': t.map(t => b + (L / Math.sqrt(R**2 + b**2 - 2 * b * R * Math.cos(t)) - 1) * (b - R * Math.cos(t))), 'y': t.map(t => R * (1 - L / Math.sqrt(R**2 + b**2 - 2 * b * R * Math.cos(t))) * Math.sin(t)), 'mode': 'lines', 'line': { 'simplify': false, 'color': 'cyan', 'width': 3  } });
  }
  mthlyTraces.push({ 'x': [X, xx], 'y': [Y, yy], 'mode': 'lines', 'line': { 'color': 'orange', 'width': 3  } });

  mthlyTraces.push({ 'x': [X], 'y': [Y], 'mode': 'markers', 'marker': { 'color': 'blue', 'size': 10  } });

  mthlyTraces.push({ 'x': [b], 'y': [0], 'mode': 'markers', 'marker': { 'color': 'grey', 'size': 10  } });

  mthlyTraces.push({ 'x': [xx], 'y': [yy], 'mode': 'markers', 'marker': { 'color': 'red', 'size': 10  } });

  document.getElementById("displaytext").innerHTML = displaytext();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyOldCs = [99999999,99999999,99999999,99999999];
var mthlyNewCs = [];
function mthlyAnimatePlot() {
  if (mthlyAutoPlayq) {
    let x = String(Number(mthlySldr1.value) + mthlySldr1step);
    mthlySldr1.value = String(x);
    if (x > 1) { mthlySldr1.value = '0'; }
    document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value;
  }
  p = Number(mthlySldr1.value);
  R = Number(mthlySldr2.value);
  b = Number(mthlySldr3.value);
  L = Number(mthlySldr4.value);
  t = []; for (let i = 0; i <= p * (6.2831853071796 + 0) - 0; i += 0.012566370614359) { t.push(i); };
  T = t[t.length - 1];
  if (true) { const t = T; X = R * Math.cos(t) + 0*b + 0*L; Y = R * Math.sin(t); };
  // has any controls changed?
  mthlyNewCs = [p, R, b, L];
  var unchangedq = true;
  for (let i = 0; i < 4; i++) {
    if (Math.abs(mthlyOldCs[i] - mthlyNewCs[i]) > 0.00001) {
      unchangedq = false; break;
    }
  }
  if (unchangedq) { return; }
  mthlyOldCs = [p, R, b, L]; // update values of controls

  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    'data': mthlyTraces,
    'traces': mthlyTraces.keys() // update all traces
  }, {
    'transition': { 'duration': 0 },
    'frame': { 'duration': 0 }
  });
}

document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value;
mthlySldr1.addEventListener("input", function() { document.getElementById("mthlySldr1value").innerHTML = mthlySldr1.value; mthlyAutoPlayq = false; mthlyAnimatePlot() });
document.getElementById("mthlySldr2value").innerHTML = mthlySldr2.value;
mthlySldr2.addEventListener("input", function() { document.getElementById("mthlySldr2value").innerHTML = mthlySldr2.value; mthlyAutoPlayq = false; mthlyAnimatePlot() });
document.getElementById("mthlySldr3value").innerHTML = mthlySldr3.value;
mthlySldr3.addEventListener("input", function() { document.getElementById("mthlySldr3value").innerHTML = mthlySldr3.value; mthlyAutoPlayq = false; mthlyAnimatePlot() });
document.getElementById("mthlySldr4value").innerHTML = mthlySldr4.value;
mthlySldr4.addEventListener("input", function() { document.getElementById("mthlySldr4value").innerHTML = mthlySldr4.value; mthlyAutoPlayq = false; mthlyAnimatePlot() });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
