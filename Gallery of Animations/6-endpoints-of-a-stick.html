<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:640px;height:480px;display:inline-block;top:110px;position:absolute;"></div>
<span id='title' style="width:640px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button id='mthlyPlayButtn' type="button" onclick="mthlyPlay()" style="width:68px;left:372px;top:60px;position:absolute">Pause</button>
<button type="button" onclick=mthlySpeedUp(-50) style="width:60px;left:443px;top:60px;position:absolute">Slower</button>
<button type="button" onclick=mthlySpeedUp(50) style="width:60px;left:506px;top:60px;position:absolute">Faster</button>
<label for="mthlySldrp" style='top:60px;'>Play:</label>
<input type="range" id="mthlySldrp" min="0" max="1" value="0" style='left:96px;top:60px;' step="0.01"></input><span id="mthlySldrpvalue" style="left:317px;top:60px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlyRNext(-1)" style="width:48px;left:372px;top:90px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyRNext(1)" style="width:48px;left:423px;top:90px;position:absolute">Next</button>
<label for="mthlySldrR" style='top:90px;'>R:</label>
<input type="range" id="mthlySldrR" min="0.1" max="5" value="0.1" style='left:96px;top:90px;' step="0.1"></input><span id="mthlySldrRvalue" style="left:317px;top:90px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlybNext(-1)" style="width:48px;left:372px;top:120px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlybNext(1)" style="width:48px;left:423px;top:120px;position:absolute">Next</button>
<label for="mthlySldrb" style='top:120px;'>b:</label>
<input type="range" id="mthlySldrb" min="0.1" max="5" value="0.1" style='left:96px;top:120px;' step="0.1"></input><span id="mthlySldrbvalue" style="left:317px;top:120px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlyLNext(-1)" style="width:48px;left:372px;top:150px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyLNext(1)" style="width:48px;left:423px;top:150px;position:absolute">Next</button>
<label for="mthlySldrL" style='top:150px;'>L:</label>
<input type="range" id="mthlySldrL" min="0.1" max="5" value="0.1" style='left:96px;top:150px;' step="0.1"></input><span id="mthlySldrLvalue" style="left:317px;top:150px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:180px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return ""; }
var x = [], t = [], X, Y, T, p;
function mthlyRNext(d) {
  let x = R + d*mthlyRStep;
  if (x < mthlyRMin) {
    x = mthlyRMax;
  } else if (x > mthlyRMax) {
    x = mthlyRMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrR.value = x;
  document.getElementById("mthlySldrRvalue").innerHTML = x;
}
function mthlybNext(d) {
  let x = b + d*mthlybStep;
  if (x < mthlybMin) {
    x = mthlybMax;
  } else if (x > mthlybMax) {
    x = mthlybMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrb.value = x;
  document.getElementById("mthlySldrbvalue").innerHTML = x;
}
function mthlyLNext(d) {
  let x = L + d*mthlyLStep;
  if (x < mthlyLMin) {
    x = mthlyLMax;
  } else if (x > mthlyLMax) {
    x = mthlyLMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrL.value = x;
  document.getElementById("mthlySldrLvalue").innerHTML = x;
}

var mthlyAutoPlayq = true, mthlyIntervalId = null, mthlyInterval = 200;
const mthlyPlayButtn = document.getElementById('mthlyPlayButtn');
function mthlyPlayButtnTxt() { mthlyPlayButtn.textContent = mthlyAutoPlayq? 'Pause' : 'Resume'; }
function mthlyPlay() { mthlyAutoPlayq = !mthlyAutoPlayq; mthlyPlayButtnTxt(); }
function mthlySpeedUp(step) {
  mthlyAutoPlayq = true; mthlyPlayButtnTxt();
  if (mthlyIntervalId != null) { clearInterval(mthlyIntervalId); }
  mthlyInterval -= step;
  if (mthlyInterval <= 0) { mthlyInterval = 10; }
  mthlyIntervalId = setInterval(mthlyAnimatePlot, mthlyInterval);
}
var mthlySldrpstep = 0.01;

const mthlyLayout = {
  xaxis: { range: [-3, 5], showgrid: false, zeroline: false, showticklabels: false}, // plot with fixed axes
  yaxis: { range: [-5, 5], showgrid: false, zeroline: false, showticklabels: false, scaleanchor: 'x', scaleratio: 1 },
  showlegend: false
};

var mthlySldrp = document.getElementById('mthlySldrp');
var mthlySldrR = document.getElementById('mthlySldrR');
var mthlySldrb = document.getElementById('mthlySldrb');
var mthlySldrL = document.getElementById('mthlySldrL');
mthlySldrp.value = 0;
var p = 0;
mthlySldrR.value = 2;
var R = 2;
mthlySldrb.value = 2.7;
var b = 2.7;
mthlySldrL.value = 5;
var L = 5;
for (let i = 0; i <= p * (6.2831853071796 + 0) - 0; i += 0.012566370614359) { t.push(i); }
let mthlyTmp = t[t.length - 1];
if (true) { const t = mthlyTmp; X = R * Math.cos(t) + 0*b + 0*L; Y = R * Math.sin(t); T = mthlyTmp; }

var mthlyTraces = [];
const mthlyxMin = -3, mthlyxMax = 5, mthlyxStep = 1;
const mthlyyMin = -5, mthlyyMax = 5;
const mthlytMin = 0, mthlytMax = 6.2831853071796, mthlytStep = 0.01;
const mthlypMin = 0, mthlypMax = 1, mthlypStep = 0.01;
const mthlyRMin = 0.1, mthlyRMax = 5, mthlyRStep = 0.1;
const mthlybMin = 0.1, mthlybMax = 5, mthlybStep = 0.1;
const mthlyLMin = 0.1, mthlyLMax = 5, mthlyLStep = 0.1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  // The line passes thru (b,0) and (X,Y) is y = (Y/(X-b))(x-b). So, x = b + ((X-b)/Y)y. Solve
  // (x-X)^2 + (y-Y)^2 = L^2 for y and then obtain x.
  var Xb = X - b;
  var z = Xb / Y;
  var xx, yy = Y + Xb*z;
  var s = Math.sqrt(L*L - b*b - (Xb - b)*X + 2*Y*Xb*z + (L*L - Y*Y)*z*z);
  if (Y > 0) {
    yy = yy - s;
  } else {
    yy = yy + s;
  }
  yy = yy / (1 + z*z);
  xx = b + z * yy;
  // function displaytext() { return 'Hello! L = ' + L; }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: t.map(t => R * Math.cos(t) + 0*b + 0*L), y: t.map(t => R * Math.sin(t)), mode: 'lines', line: { simplify: false }, fill: 'none' });
  if (true) {
    const t = [];
    for (let i = 0; i <= 6.2831853071796; i += 0.012566370614359) { t.push(i); }
    mthlyTraces.push({ x: t.map(t => R * Math.cos(t) + 0*b + 0*L), y: t.map(t => R * Math.sin(t)), mode: 'lines', line: { simplify: false, color: 'blue', width: 3  }, fill: 'none' });
  }
  if (true) {
    const t = [];
    for (let i = 0; i <= 6.2831853071796; i += 0.012566370614359) { t.push(i); }
    mthlyTraces.push({ x: t.map(t => b + (L / Math.sqrt(R**2 + b**2 - 2 * b * R * Math.cos(t)) - 1) * (b - R * Math.cos(t))), y: t.map(t => R * (1 - L / Math.sqrt(R**2 + b**2 - 2 * b * R * Math.cos(t))) * Math.sin(t)), mode: 'lines', line: { simplify: false, color: 'cyan', width: 3  }, fill: 'none' });
  }
  mthlyTraces.push({ x: [X, xx], y: [Y, yy], mode: 'lines', line: { color: 'orange', width: 3  } });
  mthlyTraces.push({ x: [X], y: [Y], mode: 'markers', marker: { color: 'blue', size: 10.000000  } });
  mthlyTraces.push({ x: [b], y: [0], mode: 'markers', marker: { color: 'grey', size: 10.000000  } });
  mthlyTraces.push({ x: [xx], y: [yy], mode: 'markers', marker: { color: 'red', size: 10.000000  } });
  mthlyPlayButtnTxt();
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999, 99999999, 99999999, 99999999];

function mthlyAnimatePlot() {
  if (mthlyAutoPlayq) {
    let x = String(Number(mthlySldrp.value) + mthlySldrpstep);
    mthlySldrp.value = String(x);
    if (x > 1) { mthlySldrp.value = '0'; }
    document.getElementById("mthlySldrpvalue").innerHTML = '' + Math.round(mthlySldrp.value*100) + '%'
  }
  p = Number(mthlySldrp.value);
  R = Number(mthlySldrR.value);
  b = Number(mthlySldrb.value);
  L = Number(mthlySldrL.value);
  t = []; for (let i = 0; i <= p * (6.2831853071796 + 0) - 0; i += 0.012566370614359) { t.push(i); };
  T = t[t.length - 1];
  if (true) { const t = T; X = R * Math.cos(t) + 0*b + 0*L; Y = R * Math.sin(t); };
  // has any controls changed?
  mthlyNewCs = [p, R, b, L];
  var unchangedq = true;
  for (let i = 0; i < 4; i++) {
    if (Math.abs(mthlyOldCs[i] - mthlyNewCs[i]) > 0.00001) {
      unchangedq = false; break;
    }
  }
  if (unchangedq) { return; }
  mthlyOldCs = [p, R, b, L]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrpvalue").innerHTML = mthlySldrp.value;
mthlySldrp.addEventListener("input", function() { document.getElementById("mthlySldrpvalue").innerHTML = mthlySldrp.value; });
document.getElementById("mthlySldrRvalue").innerHTML = mthlySldrR.value;
mthlySldrR.addEventListener("input", function() { document.getElementById("mthlySldrRvalue").innerHTML = mthlySldrR.value; });
document.getElementById("mthlySldrbvalue").innerHTML = mthlySldrb.value;
mthlySldrb.addEventListener("input", function() { document.getElementById("mthlySldrbvalue").innerHTML = mthlySldrb.value; });
document.getElementById("mthlySldrLvalue").innerHTML = mthlySldrL.value;
mthlySldrL.addEventListener("input", function() { document.getElementById("mthlySldrLvalue").innerHTML = mthlySldrL.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
