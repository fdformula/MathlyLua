<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:400px;height:600px;display:inline-block;top:50px;position:absolute;"></div>
<span id='title' style="width:400px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" title="Previous value" onclick="mthlyINext(-1)" style="width:48px;left:508px;top:60px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyINext(1)" style="width:48px;left:559px;top:60px;position:absolute">Next</button>
<label for="mthlySldrI" style='top:60px;'>Number of first terms:</label>
<input type="range" id="mthlySldrI" min="2" max="53" value="2" style='left:232px;top:60px;' step="1"></input><span id="mthlySldrIvalue" style="left:453px;top:60px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:90px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return "Approximating <em>e<sup>x</sup></em>"; }
var x = [], t = [], X, Y, T, p, mthlyGlobal = [], mthlyGlobal1 = [], mthlyGlobal2 = [], mthlyGlobal3 = [], mthlyGlobal4 = [], mthlyGlobal5 = [];
function mthlyINext(x) {
  x = I + x*mthlyIStep;
  if (x < mthlyIMin) {
    x = mthlyIMax;
  } else if (x > mthlyIMax) {
    x = mthlyIMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrI.value = x;
  document.getElementById("mthlySldrIvalue").innerHTML = x;
}

const mthlyLayout = {
  xaxis: { range: [-20, 5]}, // plot with fixed axes
  yaxis: { range: [-5, 100] },
  showlegend: false
};

var mthlySldrI = document.getElementById('mthlySldrI');
mthlySldrI.value = 2;
var I = 2;
p = 1;
for (let i = -20; i <= p * (5 + 20) - 20; i += 0.05) { x.push(i); }; t = x;

var mthlyTraces = [];
const mthlyxMin = -20, mthlyxMax = 5, mthlyxStep = 1;
const mthlyyMin = -5, mthlyyMax = 100;
const mthlytMin = -20, mthlytMax = 5, mthlytStep = 1;
const mthlyIMin = 2, mthlyIMax = 53, mthlyIStep = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
const maxI = 53;
function taylorCoeffs() { // coefficients of the first maxI terms of the Taylor series
  // mthlyGlobal = []; // unnecessary
  var factorial = 1;
  for(let i = 0; i < maxI; i++) {
    if (i > 0) { factorial *= i; }
    mthlyGlobal.push(1 / factorial);  // global variable mthlyGlobal is used to save the coefficients of Taylor series
  }
}

if (mthlyGlobal.length == 0) { taylorCoeffs(); }

function taylor(x) { // evaluate the first I terms of the Taylor series at x
  var sum = 0, X = 1;
  for(let i = 0; i < I; i++) {
    sum += mthlyGlobal[i] * X;
    X *= x;
  }
  return sum;
}

function displaytext() {
  const n = I - 1;
  var s = 'P<sub>' + n + '</sub>(x) = 1 + x/1! '
  if (I > 2) {
    s = s + '+ x<sup>2</sup>/2! ';
    if (I > 3) {
      if (I == 4) {
        s = s + '+ x<sup>3</sup>/3! ';
      } else if (I > 4) {
        s = s + '+ ... + x<sup>' + n + '</sup>/' + n + '!';
      }
    }
  }
  return s;
}
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: x, y: x.map(x => Math.exp(x)), mode: 'lines', line: { simplify: false, width: 3 }, fill: 'none' });
  if (true) {
    mthlyTraces.push({ x: t.map(t => t), y: t.map(t => taylor(t)), mode: 'lines', line: { simplify: false, color: 'red', width: 3  }, fill: 'none' });
  }
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999];

function mthlyAnimatePlot() {
  I = Number(mthlySldrI.value);
  // has any controls changed?
  mthlyNewCs = [I];
  if (Math.abs(mthlyOldCs[0] - mthlyNewCs[0]) < 0.00001) { return; }
  mthlyOldCs = [I]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value;
mthlySldrI.addEventListener("input", function() { document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
