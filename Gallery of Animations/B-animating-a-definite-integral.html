<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:640px;height:640px;display:inline-block;top:50px;position:absolute;"></div>
<span id='title' style="width:640px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" title="Previous value" onclick="mthlyONext(-1)" style="width:48px;left:436px;top:60px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyONext(1)" style="width:48px;left:487px;top:60px;position:absolute">Next</button>
<label for="mthlySldrO" style='top:60px;'>Method:</label>
<input type="range" id="mthlySldrO" min="1" max="5" value="1" style='left:160px;top:60px;' step="1"></input><span id="mthlySldrOvalue" style="left:381px;top:60px;position:absolute">&nbsp;</span>
<button type="button" title="Previous value" onclick="mthlyNNext(-1)" style="width:48px;left:436px;top:90px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyNNext(1)" style="width:48px;left:487px;top:90px;position:absolute">Next</button>
<label for="mthlySldrN" style='top:90px;'>Subintervals:</label>
<input type="range" id="mthlySldrN" min="1" max="50" value="1" style='left:160px;top:90px;' step="1"></input><span id="mthlySldrNvalue" style="left:381px;top:90px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:120px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return "<h3>Animating the integral of f(x) = 1 - x<sup>2</sup> on [0, 1]</h3>"; }
var x = [], t = [], X, Y, T, p;
function mthlyONext(d) {
  let x = O + d*mthlyOStep;
  if (x < mthlyOMin) {
    x = mthlyOMax;
  } else if (x > mthlyOMax) {
    x = mthlyOMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrO.value = x;
  document.getElementById("mthlySldrOvalue").innerHTML = x;
}
function mthlyNNext(d) {
  let x = N + d*mthlyNStep;
  if (x < mthlyNMin) {
    x = mthlyNMax;
  } else if (x > mthlyNMax) {
    x = mthlyNMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrN.value = x;
  document.getElementById("mthlySldrNvalue").innerHTML = x;
}

const mthlyLayout = {
  xaxis: { range: [-0.1, 1.1], showgrid: false}, // plot with fixed axes
  yaxis: { range: [-0.1, 1.12], showgrid: false, scaleanchor: 'x', scaleratio: 1 },
  showlegend: false
};

var mthlySldrO = document.getElementById('mthlySldrO');
var mthlySldrN = document.getElementById('mthlySldrN');
mthlySldrO.value = 3;
var O = 3;
mthlySldrN.value = 50;
var N = 50;
p = 1;
for (let i = -0.1; i <= p * (1.1 + 0.1) - 0.1; i += 0.0024) { x.push(i); }; t = x;

var mthlyTraces = [];
const mthlyxMin = -0.1, mthlyxMax = 1.1, mthlyxStep = 1;
const mthlyyMin = -0.1, mthlyyMax = 1.12;
const mthlytMin = -0.1, mthlytMax = 1.1, mthlytStep = 1;
const mthlyOMin = 1, mthlyOMax = 5, mthlyOStep = 1;
const mthlyNMin = 1, mthlyNMax = 50, mthlyNStep = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
  function f(x) { return 1 - x*x; }
  const a = 0, b = 1;

  const style = { 'color': 'grey', 'width': 1};
  var rule;
  function sum() {
    var x1 = a, x, randq = false, s = 0, h = (b - a) / N, trapzq = false, f1, f2;
    if (O == 1) {
      x = a;
      rule = 'Left endpoint';
    } else if (O == 2) {
      x = a + h;
      rule = 'Right endpoint';
    } else if (O == 3) {
      x = a + h/2;
      rule = 'Midpoint';
    } else if (O == 4) {
      randq = true;
      x = a + h * Math.random();
      rule = 'Random point';
    } else {
      rule = 'Trapezoidal';
      x = a; f1 = f(x1);
      trapzq = true;
    }
    for (let i = 0; i < N; i++) {
      const x2 = x1 + h, fx = f(x);
      if (trapzq) {
        f2 = f(x2);
        mthlyTraces.push({x: [x1, x1], y: [0, f1], mode: 'lines', line: style});
        mthlyTraces.push({x: [x1, x2], y: [f1, f2], mode: 'lines', line: style});
        mthlyTraces.push({x: [x2, x2], y: [f2, 0], mode: 'lines', line: style});
        if (i < N - 1) { s += f2; }
        f1 = f2;
      } else {
        mthlyTraces.push({x: [x1, x1], y: [0, fx], mode: 'lines', line: style});
        mthlyTraces.push({x: [x1, x2], y: [fx, fx], mode: 'lines', line: style});
        mthlyTraces.push({x: [x2, x2], y: [fx, 0], mode: 'lines', line: style});
        if (O == 3 || O == 4) {
          mthlyTraces.push({x: [x, x], y: [0, fx], mode: 'lines', line: { color: 'grey', width: 0.3}}); // dash: 'dot'
          mthlyTraces.push({x: [x], y: [0], mode: 'markers', marker: { color: 'red', size: 6}});
        }
        s += fx;
      }
      x1 = x2;
      if (randq) { x = x1 + h * Math.random(); } else { x = x + h; }
    }

    // plot enough extra objects outside the graph so that no old traces will stay - ugly, but works!
    x = mthlyxMax + 5;
    for (i = 0; i < mthlyNMax * 5; i++) {
      mthlyTraces.push({ x: [x], y: [mthlyyMax + 5], mode: 'markers'});
      x += h;
    }

    if (trapzq) { s += (f(a) + f2) / 2; }
    return s * h;
  }
  function displaytext() { const s = sum(); return rule + ' method: A = ' + s + ' (Exact value: 2/3 or 0.6666666666666667)'; }
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: x, y: x.map(x => 1 - x**2), mode: 'lines', line: { simplify: false }, fill: 'none' });
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999, 99999999];

function mthlyAnimatePlot() {
  O = Number(mthlySldrO.value);
  N = Number(mthlySldrN.value);
  // has any controls changed?
  mthlyNewCs = [O, N];
  var unchangedq = true;
  for (let i = 0; i < 2; i++) {
    if (Math.abs(mthlyOldCs[i] - mthlyNewCs[i]) > 0.00001) {
      unchangedq = false; break;
    }
  }
  if (unchangedq) { return; }
  mthlyOldCs = [O, N]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrOvalue").innerHTML = mthlySldrO.value;
mthlySldrO.addEventListener("input", function() { document.getElementById("mthlySldrOvalue").innerHTML = mthlySldrO.value; });
document.getElementById("mthlySldrNvalue").innerHTML = mthlySldrN.value;
mthlySldrN.addEventListener("input", function() { document.getElementById("mthlySldrNvalue").innerHTML = mthlySldrN.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
