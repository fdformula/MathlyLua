<!DOCTYPE html><!-- generated by Lua + Mathly: https://github.com/fdformula/MathlyLua -->
<html>
<head>
 <meta charset="utf-8">
 <title>Mathly Function Animation</title>
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
label {
 display: inline-block;
 width: 10px;
 left: 50px;
 text-align: left;
 vertical-align: middle;
 position: absolute;
 white-space: nowrap;
}
input {
 display: inline-block;
 width: 200px;
 left: 65px;
 vertical-align: middle;
 position: absolute;
}
input:focus {outline: none;}
</style>
</head>
<body>
<div id="mathlyDiv" style="width:600px;height:500px;display:inline-block;top:50px;position:absolute;"></div>
<span id='title' style="width:600px;left:0px;display:block;text-align:center;">&nbsp;</span>
<!-- controls -->
<button type="button" title="Previous value" onclick="mthlyINext(-1)" style="width:48px;left:412px;top:60px;position:absolute">Prev</button>
<button type="button" title="Next value" onclick="mthlyINext(1)" style="width:48px;left:463px;top:60px;position:absolute">Next</button>
<label for="mthlySldrI" style='top:60px;'>Guess No.:</label>
<input type="range" id="mthlySldrI" min="1" max="20" value="1" style='left:136px;top:60px;' step="1"></input><span id="mthlySldrIvalue" style="left:357px;top:60px;position:absolute">&nbsp;</span>
<span id="displaytext" style="left:74px;top:90px;position:absolute">&nbsp;</span>
<script type="text/javascript">
function displaytext() { return ""; } // to be overwritten
function displaytitle() { return "Shooting method for y\" = -2y + 5sqrt(x) + 2x - 5, y(0) = 1, y(5) = 2 on [0, 5]<br>&rArr; Solved as w' = -2y + 5sqrt(x) + 2x - 5, w(0) = w<sub>0</sub> and y' = w, y(0) = 1"; }
var x = [], t = [], X, Y, T, p;
function mthlyINext(x) {
  x = I + x*mthlyIStep;
  if (x < mthlyIMin) {
    x = mthlyIMax;
  } else if (x > mthlyIMax) {
    x = mthlyIMin;
  }
  x = Math.round(x * 1000) / 1000;
  mthlySldrI.value = x;
  document.getElementById("mthlySldrIvalue").innerHTML = x;
}

const mthlyLayout = {
  xaxis: { range: [-0.1, 5.1]}, // plot with fixed axes
  yaxis: { range: [-10, 18] },
  showlegend: false
};

var mthlySldrI = document.getElementById('mthlySldrI');
mthlySldrI.value = 1;
var I = 1;
p = 1;
for (let i = -0.1; i <= p * (5.1 + 0.1) - 0.1; i += 0.0104) { x.push(i); }; t = x;

var mthlyTraces = [];
const mthlyxMin = -0.1, mthlyxMax = 5.1, mthlyxStep = 1;
const mthlyyMin = -10, mthlyyMax = 18;
const mthlytMin = -0.1, mthlytMax = 5.1, mthlytStep = 1;
const mthlyIMin = 1, mthlyIMax = 20, mthlyIStep = 1;

function mthlyUpdateTraces() {
  mthlyTraces = [];

  // vvvvv user's javascript vvvvv
const a = 0.000000, b = 5.000000, Ya = 1.000000, Yb = 2.000000;
const n = 300;
const h = (b - a) / n, tol = 1e-15;

function fw(x, y, w) { return -2*y + 5*Math.sqrt(x) + 2*x - 5; } // dw/dx = -2y + 5sqrt(x) + 2x - 5; w(a) = ?
function fy(x, y, w) { return w; }       // dy/dx = w;      y(a) = Ya

const x = []; // shared data x
{var v = a; for (let i = 1; i <= n + 1; i++) { x.push(v); v += h; }}

var w, y, E1, E2;
var W1 = -5, W2 = 0; // the first 2 guesses of w(a)

function iterate() {
  for(let j = 0; j < I; j++) { // I? control
    var W;
    if (j == 0) {
      W = W1;
    } else if (j == 1) {
      W = W2;
    } else {
      W = W1 - (W2 - W1) / (E2 - E1) * E1; // guess W as a linear function of error E
    }

    w = [W]; y = [Ya];
    for(i = 0; i < n; i++) {
      const fyv = fy(x[i], y[i], w[i]), fwv = fw(x[i], y[i], w[i]);
      const I = i + 1;
      y[I] = y[i] + fyv * h; // Euler's method
      w[I] = w[i] + fwv * h;
      // y[I] = y[i] + 0.5 * (fyv + fy(x[I], y[I], w[I])) * h; // modified Euler's method
      // w[I] = w[i] + 0.5 * (fwv + fw(x[I], y[I], w[I])) * h;
    }
    const E = y[n] - Yb;
    mthlyTraces.push({ x: x, y: y, mode: 'lines', line: { simplify: false, width: (Math.abs(E) < tol || j == I - 1)? 4 : 1 }, fill: 'none' });
    mthlyTraces.push({ x: [5.000000], y: [y[n] ], mode: 'markers', marker: { color: 'grey', size: 6 } });

    if (j == 0) {
      E1 = E;
    } else if (j == 1) {
      E2 = E;
    } else {
      E1 = E2; E2 = E;
      W1 = W2; W2 = W;
    }
    if (Math.abs(E) < tol) { return [W, y[n], j + 1]; }
  }
  // plot enough extra objects outside the graph so that no old traces will stay - ugly, but works!
  for (i = 0; i < 2*(mthlyIMax - mthlyIMin + 1) / mthlyIStep; i++) {
    mthlyTraces.push({ x: [a], y: [mthlyyMax + 5], mode: 'markers'});
  }
  return [w[0], y[n] ]
}

function displaytext() {
  let v = iterate();
  if (v.length == 3) {
    return 'Done after ' + v[2] + ' attempts with w<sub>0</sub> = ' + v[0] + ' & y(5) = ' + v[1] + '.'
  } else {
    return 'w<sub>0</sub> = ' + v[0] + ', y(5) = ' + v[1] + ' (Yb = ' + Yb + ')';
  }
}
  // ^^^^^ user's javascript ^^^^^

  mthlyTraces.push({ x: [5.0], y: [2.0], mode: 'markers', marker: { color: 'red', size: 10.000000  } });
  mthlyTraces.push({ x: [3.6], y: [-3], text: 'Note: The red point is the target, and a', mode: 'text', type: 'scatter', textposition: 'bottom center', name: '', textfont: { color: 'black', size: 12.000000  } });
  mthlyTraces.push({ x: [3.8], y: [-4.5], text: 'new guess is a linear function of', mode: 'text', type: 'scatter', textposition: 'bottom center', name: '', textfont: { color: 'black', size: 12.000000  } });
  mthlyTraces.push({ x: [3.85], y: [-6], text: 'the errors at x = 5 corresponding', mode: 'text', type: 'scatter', textposition: 'bottom center', name: '', textfont: { color: 'black', size: 12.000000  } });
  mthlyTraces.push({ x: [3.6], y: [-7.5], text: 'to the previous 2 guesses.', mode: 'text', type: 'scatter', textposition: 'bottom center', name: '', textfont: { color: 'black', size: 12.000000  } });
  document.getElementById("displaytext").innerHTML = displaytext();
  document.getElementById("title").innerHTML = displaytitle();
}

mthlyUpdateTraces();
const mthlyInitData = mthlyTraces;

var mthlyNewCs = [], mthlyOldCs = [99999999];

function mthlyAnimatePlot() {
  I = Number(mthlySldrI.value);
  // has any controls changed?
  mthlyNewCs = [I];
  if (Math.abs(mthlyOldCs[0] - mthlyNewCs[0]) < 0.00001) { return; }
  mthlyOldCs = [I]; // update values of controls
  mthlyUpdateTraces();
  Plotly.animate('mathlyDiv', {
    data: mthlyTraces,
    traces: mthlyTraces.keys() // update all traces
  }, {
    transition: { duration: 0 },
    frame: { duration: 0 }
  });
}

document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value;
mthlySldrI.addEventListener("input", function() { document.getElementById("mthlySldrIvalue").innerHTML = mthlySldrI.value; });

Plotly.newPlot('mathlyDiv', mthlyInitData, mthlyLayout);
mthlyAnimatePlot();
mthlyIntervalId = setInterval(mthlyAnimatePlot, 200); // animate every 0.2 seconds
</script>
</body>
</html>
